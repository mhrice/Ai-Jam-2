(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{106:function(e,t){},120:function(e,t,a){e.exports=a(271)},125:function(e,t,a){},127:function(e,t,a){},131:function(e,t){},132:function(e,t){},134:function(e,t){},166:function(e,t){},167:function(e,t){},213:function(e,t){},214:function(e,t){},268:function(e,t,a){},271:function(e,t,a){"use strict";a.r(t);var n=a(4),r=a.n(n),o=a(116),s=a.n(o),i=(a(125),a(8)),c=a.n(i),l=a(18),u=a(66),m=a(9),d=a(7),p=a(43),h=a(42),y=a(44),v=(a(127),a(14)),f=(v.sequences.quantizeNoteSequence,v.sequences.clone),T=16,g=4;function b(e,t){return w.apply(this,arguments)}function w(){return(w=Object(l.a)(c.a.mark(function e(t,a){var n,r,o,s,i,l,u,m=arguments;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=m.length>2&&void 0!==m[2]?m[2]:1,r=a.length*T,o=1/v.sequences.stepsPerQuarterToStepsPerSecond(g,t.tempos[0].qpm),s=[],i=c.a.mark(function e(i){var l,u,m,d,p,h;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=f(t),u=Math.min(i+r,t.totalQuantizedSteps),l.notes=t.notes.map(function(e){return Object.assign({},e)}).filter(function(e){return i<=e.quantizedStartStep&&e.quantizedStartStep<u}).map(function(e){return e.startTime-=i*o,e.endTime-=i*o,e.quantizedStartStep-=i,e.quantizedEndStep-=i,e}),l.totalQuantizedSteps=u-i,l.totalTime=l.totalQuantizedSteps*o,m=Math.ceil(l.totalQuantizedSteps/T),d=m-1,e.next=9,a[d].encode([l]);case 9:return p=e.sent,e.next=12,a[d].decode(p,n,void 0,void 0,t.tempos[0].qpm);case 12:h=e.sent,p.dispose(),s.push(h[0]);case 15:case"end":return e.stop()}},e)}),l=0;case 6:if(!(l<t.totalQuantizedSteps)){e.next=11;break}return e.delegateYield(i(l),"t0",8);case 8:l+=r,e.next=6;break;case 11:return u=k.apply(void 0,s),e.abrupt("return",u);case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function k(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];if(2===t.length){var n=t[0],r=t[1],o=f(n);return r.notes.forEach(function(e){var t=Object.assign({},e);t.startTime+=n.totalTime,t.endTime+=n.totalTime,o.notes.push(t)}),o.totalTime=n.totalTime+r.totalTime,o}return t.length>2?k(t.shift(),k.apply(void 0,t)):t[0]}var S=function(){function e(){Object(m.a)(this,e);this.models=["https://storage.googleapis.com/magentadata/js/checkpoints/music_vae/groovae_2bar_humanize"].map(function(e){return new v.MusicVAE(e)})}return Object(d.a)(e,[{key:"load",value:function(){var e=Object(l.a)(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.models.forEach(function(e){return e.initialize()});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log(e.t0);case 8:case"end":return e.stop()}},e,this,[[0,5]])}));return function(){return e.apply(this,arguments)}}()},{key:"drumify",value:function(){var e=Object(l.a)(c.a.mark(function e(t){var a,n=arguments;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.length>1&&void 0!==n[1]?n[1]:1,e.next=3,b(t,this.models,a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),P=v.sequences.unquantizeSequence,M=v.sequences.clone,V=function(){function e(){Object(m.a)(this,e),this.model=new v.MusicRNN("https://storage.googleapis.com/magentadata/js/checkpoints/music_rnn/melody_rnn")}return Object(d.a)(e,[{key:"load",value:function(){var e=Object(l.a)(c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.model.initialize();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"predict",value:function(){var e=Object(l.a)(c.a.mark(function e(t){var a,n,r,o,s,i,l=arguments;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=l.length>1&&void 0!==l[1]?l[1]:1,n=l.length>2&&void 0!==l[2]?l[2]:32,r=l.length>3&&void 0!==l[3]?l[3]:1,o=[],s=0;case 5:if(!(s<r)){e.next=15;break}return e.next=8,this.model.continueSequence(t,n,a);case 8:return i=e.sent,(i=P(i,t.tempos[0].qpm)).notes.forEach(function(e){return e.ai=!0}),e.abrupt("return",i);case 12:s++,e.next=5;break;case 15:return e.abrupt("return",o);case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"concat",value:function(e,t){var a=M(e);return t.notes.forEach(function(t){t.startTime+=e.totalTime,t.endTime+=e.totalTime,t.quantizedStartStep+=e.totalQuantizedSteps,t.quantizedEndStep+=e.totalQuantizedSteps,a.notes.push(t)}),a.totalTime+=t.totalTime,a.totalQuantizedSteps+=t.totalQuantizedSteps,a}}]),e}(),N=a(65),q=a.n(N),E=a(1),x=a.n(E),R=(a(268),function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(h.a)(t).call(this))).state={opacity:1},e}return Object(y.a)(t,e),Object(d.a)(t,[{key:"trigger",value:function(){var e=this;this.setState({opacity:0}),setTimeout(function(){e.setState({opacity:1})},.02)}},{key:"render",value:function(){return r.a.createElement("div",{className:"interface-container"},r.a.createElement("div",{className:"title"},"AI Jam 2"),r.a.createElement("div",{className:"patch-container"},this.props.bassline&&r.a.createElement("div",{className:"bassline"},"Bassline"),this.props.drums&&r.a.createElement("div",{className:"drums-container"},r.a.createElement("div",{className:"drums-title"},"Drums"),r.a.createElement("div",{className:"drums-temperature"},"Temperature: ",r.a.createElement("div",{className:"drums-temperature-color"},Math.round(10*this.props.drumTemperature)/10))),this.props.melody&&r.a.createElement("div",{className:"melody-container"},r.a.createElement("div",{className:"melody-title"},"Melody")),this.props.aiMelody&&r.a.createElement("div",{className:"ai-melody-container"},r.a.createElement("div",{className:"ai-melody-title"},"Generated Melody"),r.a.createElement("div",{className:"ai-melody-temperature"},"Temperature: ",r.a.createElement("div",{className:"ai-melody-temperature-color"},Math.round(10*this.props.melodyTemperature)/10))),r.a.createElement("div",{className:"status",style:{opacity:this.state.opacity}},this.props.status)))}}]),t}(n.Component)),j=function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(h.a)(t).call(this))).onNoteDown=function(t){"stopped"===x.a.Transport.state&&e.setState({status:"Input"}),e.recording&&e.start&&(e.start=!1,x.a.Transport.position=0,x.a.Transport.start());var a=e.midiToFreq(t.note.number),n=e.getGain(1-t.velocity);e.synth.triggerAttack(a),e.synth.volume.value=n,e.rawVelocity=t.rawVelocity,e.startPosition=x.a.Transport.position,e.note=t.note.number;var r=new x.a.Time(e.startPosition).quantize("16n");e.startTime=new x.a.Time(r).toBarsBeatsSixteenths(),e.gain=n},e.onNoteUp=function(t){if(e.changeSynth){var a=e.midiToFreq(t.note.number);e.synth.triggerRelease(a)}else e.synth.triggerRelease();var n=new x.a.Time(x.a.Transport.position).quantize("16n"),r=new x.a.Time(e.startTime).toSeconds(),o=n-r;0===o&&(o=.25);var s=x.a.Transport.position,i=e.startPosition.split(":"),c=s.split(":"),l=16*Number(i[0])+4*Number(i[1])+Math.round(Number(i[2])),u=16*Number(c[0])+4*Number(c[1])+Math.round(Number(c[2]));l<31&&e.notes.push({pitch:e.note,quantizedStartStep:l,quantizedEndStep:u,startTime:r,endTime:n,duration:o,isDrum:!1,velocity:e.rawVelocity,gain:e.gain,time:e.startTime,transportStartTime:e.startPosition}),console.log(e.notes)},e.onControlChange=function(t){switch(console.log("CONTROL",t.controller.number),t.controller.number){case 51:t.value&&(e.kickAdd?(x.a.Transport.clear(e.kickLoop),e.kickAdd=!1):(e.kickAdd=!0,x.a.Transport.stop(),e.kickLoop=x.a.Transport.scheduleRepeat(function(t){e.kick.start(t),e.kickVolume=e.getGain(.21875)},"4n"),x.a.Transport.start()));break;case 52:t.value&&(e.drumAdds=!e.drumAdds);break;case 112:t.value&&(e.melodySave=!0);break;case 113:if(t.value){e.melodyNotes.length&&(e.notes=e.melodyNotes),e.aiNotes.length&&(e.notes=e.aiNotes.map(function(e){return Object(u.a)({},e,{pitch:e.pitch-12})})),e.recording=!1,x.a.Transport.stop(),x.a.Transport.cancel(),e.part&&e.part.stop(),e.basslinePart&&e.basslinePart.stop();var a=e.state.melodyTemperature-.1;a<.2&&(a=1.1),e.setState({status:"Generating New Melody",melodyTemperature:a}),e.metro=x.a.Transport.scheduleRepeat(function(t){e.metroPlayer.loaded&&(e.metroPlayer.start(t),e.interfaceRef.current.trigger())},"4n"),e.createSequence(!0).then(function(t){console.log(t.notes),e.setState({aiMelodyPresent:!0,status:"Looping All Elements"}),e.aiNotes=t.notes.map(function(e){var t=e.endTime-e.startTime,a=new x.a.Time(e.startTime).toBarsBeatsSixteenths();return 0===t&&(t=.25),Object(u.a)({},e,{pitch:e.pitch+12,time:a,duration:t,gain:-1*Math.random()*10})}),e.playDrumsAndSequence(!0)}),e.melodyGenerated=!0}break;case 114:t.value&&(e.recording=!1,e.newSequence=!1,x.a.Transport.stop(),x.a.Transport.loop=!1,e.part&&e.part.stop(),e.basslinePart&&e.basslinePart.stop(),e.setState({status:"Input",melodyTemperature:1.1,drumTemperature:1.1,basslinePresent:!1,drumsPresent:!1,melodyPresent:!1,aiMelodyPresent:!1}),x.a.Transport.cancel(),e.melodyGenerated=!1,e.melodySave=!1,e.kickAdd=!1,e.drumAdds=!1,e.firstDrumsGeneration=!0,e.changeSynth=!1,e.notes=[],e.bassline=[],e.melodyNotes=[],e.aiNotes=[],e.synth=new x.a.FMSynth({modulationIndex:15,modulationEnvelope:{attack:.1,decay:.1}}),e.synth.connect(x.a.Master),e.synth.connect(e.reverb));break;case 116:if(t.value){e.kickAdd=!1,e.firstDrumsGeneration&&(e.bassline=e.notes,e.firstDrumsGeneration=!1);var n=e.state.drumTemperature-.1;n<.2&&(n=1.1),e.setState({status:"Generating Drums...",drumTemperature:n}),e.bassline.length&&(e.notes=e.bassline),e.recording=!1,x.a.Transport.stop(),e.part&&e.part.stop(),e.basslinePart&&e.basslinePart.stop(),e.drumAdds||x.a.Transport.cancel(),e.metro=x.a.Transport.scheduleRepeat(function(t){e.metroPlayer.loaded&&(e.metroPlayer.start(t),e.interfaceRef.current.trigger())},"4n"),e.createSequence(!1).then(function(t){e.changeSynth=!0,e.synth=new x.a.PolySynth(6);var a=new x.a.Vibrato(4,.25);a.connect(e.reverb),a.connect(x.a.Master),e.synth.connect(a),e.synth.set({oscillator:{type:"fatsquare"}}),console.log(t.notes),e.drumNotes=t.notes,e.setState({drumsPresent:!0,status:"Playing Drums with Sequence"}),e.playDrumsAndSequence(!1)})}break;case 117:t.value&&e.record()}},e.state={status:"Loading Models...",melodyTemperature:1.1,drumTemperature:1.1,basslinePresent:!1,drumsPresent:!1,melodyPresent:!1,aiMelodyPresent:!1},e.interfaceRef=r.a.createRef(),e}return Object(y.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.melodyModel=new V,this.drumModel=new S,this.drumModel.load().then(function(){e.melodyModel.load().then(function(){e.setState({status:"Models Loaded. Waiting for input..."}),e.reverb=new x.a.Reverb(10),e.reverb.generate().then(function(){e.reverb.connect(x.a.Master)}),e.synth=new x.a.FMSynth({modulationIndex:15,modulationEnvelope:{attack:.1,decay:.1}}),e.synth.connect(x.a.Master),e.synth.connect(e.reverb),e.basslineSynth=new x.a.FMSynth({modulationIndex:15,modulationEnvelope:{attack:.1,decay:.1}}),e.basslineSynth.connect(x.a.Master),e.basslineSynth.connect(e.reverb),e.melodySynth=new x.a.Synth({oscillator:{type:"fatsquare"}}),e.melodySynth.connect(x.a.Master),e.melodySynth.connect(e.reverb);var t=new x.a.Vibrato(4,.25);t.connect(e.reverb),t.connect(x.a.Master),e.aiSynth=new x.a.Synth({oscillator:{type:"amsawtooth"}}),e.aiSynth.connect(t),e.metroPlayer=new x.a.Player({url:"./metronome.mp3"}),e.metroVolume=new x.a.Volume(-5),e.metroPlayer.chain(e.metroVolume,x.a.Master),x.a.context.lookAhead=0,e.kickVolume=new x.a.Volume(0),e.kick=new x.a.Player({url:"./kick.wav"}).chain(e.kickVolume,x.a.Master),e.snareVolume=new x.a.Volume(0),e.snare=new x.a.Player({url:"./snare.wav"}).chain(e.snareVolume,x.a.Master),e.closedHatVolume=new x.a.Volume(0),e.closedHat=new x.a.Player({url:"./closed_hat.wav"}).chain(e.closedHatVolume,x.a.Master),e.openHatVolume=new x.a.Volume(0),e.openHat=new x.a.Player({url:"./open_hat.wav"}).chain(e.openHatVolume,x.a.Master),e.clapVolume=new x.a.Volume(0),e.clap=new x.a.Player({url:"./clap.wav"}).chain(e.clapVolume,x.a.Master),e.highTomVolume=new x.a.Volume(0),e.highTom=new x.a.Player({url:"./high-tom.wav"}).chain(e.highTomVolume,x.a.Master),e.lowTomVolume=new x.a.Volume(0),e.lowTom=new x.a.Player({url:"./low-tom.wav"}).chain(e.lowTomVolume,x.a.Master),e.crashVolume=new x.a.Volume(0),e.crash=new x.a.Player({url:"./crash.wav"}).chain(e.crashVolume,x.a.Master),e.rideVolume=new x.a.Volume(0),e.ride=new x.a.Player({url:"./ride.wav"}).chain(e.rideVolume,x.a.Master),e.midTomVolume=new x.a.Volume(0),e.midTom=new x.a.Player({url:"./mid-tom.wav"}).chain(e.midTomVolume,x.a.Master),e.notes=[],e.kickAdd=!1,e.bassline=[],e.melodyNotes=[],e.aiNotes=[],e.recording=!1,e.start=!1,e.firstDrumsGeneration=!0,e.drumAdds=!1,e.changeSynth=!1,q.a.enable(function(t){t?console.log("WebMidi could not be enabled.",t):console.log("WebMidi enabled!");var a=q.a.inputs[0];a.addListener("noteon","all",e.onNoteDown),a.addListener("noteoff","all",e.onNoteUp),a.addListener("controlchange","all",e.onControlChange)}),e.start=!0})}),x.a.Transport.bpm.value=120}},{key:"record",value:function(){var e=this;this.recording=!0,this.notes=[],this.bassline=[],this.start=!0,this.setState({status:"Recording Bassline..."}),this.metro=x.a.Transport.scheduleRepeat(function(t){e.metroPlayer.loaded&&(e.metroPlayer.start(t),e.interfaceRef.current.trigger())},"4n"),x.a.Transport.start(),x.a.Transport.position=0,this.loop=x.a.Transport.scheduleRepeat(function(t){e.notes.length&&(x.a.Transport.cancel(),x.a.Transport.setLoopPoints(0,"2m"),x.a.Transport.loop=!0,x.a.Transport.stop(),e.playRecording())},"2m")}},{key:"playRecording",value:function(){var e=this;this.part=new x.a.Part(function(t,a){e.basslineSynth.triggerAttackRelease(e.midiToFreq(a.pitch),a.duration,t),e.basslineSynth.volume.value=a.gain},this.notes),this.metro=x.a.Transport.scheduleRepeat(function(t){e.metroPlayer.loaded&&(e.metroPlayer.start(t),e.interfaceRef.current.trigger())},"4n"),this.part.start(0),x.a.Transport.start(),x.a.Transport.position=0,this.setState({basslinePresent:!0,status:"Looping Bassline"})}},{key:"createSequence",value:function(){var e=Object(l.a)(c.a.mark(function e(t){var a;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a={timeSignatures:[{time:0,numerator:4,denominator:4}],quantizationInfo:{stepsPerQuarter:4},tempos:[{time:0,qpm:120}],totalQuantizedSteps:32,notes:this.notes},console.log(this.notes),!t){e.next=6;break}return e.next=5,this.melodyModel.predict(a,this.state.melodyTemperature);case 5:return e.abrupt("return",e.sent);case 6:return e.next=8,this.drumModel.drumify(a,this.state.drumTemperature);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"playDrumsAndSequence",value:function(e){var t=this;this.basslinePart=new x.a.Part(function(e,a){t.basslineSynth.triggerAttackRelease(t.midiToFreq(a.pitch),a.duration,e),t.basslineSynth.volume.value=a.gain},this.bassline),this.basslinePart.start(0),this.aiNotes&&(this.aiPart=new x.a.Part(function(e,a){t.aiSynth.triggerAttackRelease(t.midiToFreq(a.pitch),a.duration,e),t.aiSynth.volume.value=a.gain},this.aiNotes),this.aiPart.start(0),this.melody=new x.a.Part(function(e,a){t.melodySynth.triggerAttackRelease(t.midiToFreq(a.pitch),a.duration,e),t.melodySynth.volume.value=a.gain},this.melodyNotes),this.melody.start(0)),this.drumNotes.forEach(function(e){switch(e.startTime>4&&(e.startTime=e.startTime-2),e.startTime<0&&(e.startTime=e.startTime+2),e.endTime>4&&(e.endTime=e.endTime-2),e.endTime<0&&(e.endTime=e.endTime+2),e.pitch){case 36:x.a.Transport.schedule(function(a){t.kick.start(a),t.kickVolume=t.getGain(1-e.velocity/128)},e.startTime);break;case 38:x.a.Transport.schedule(function(a){t.snare.start(a),t.snareVolume=t.getGain(1-e.velocity/128)},e.startTime);break;case 39:x.a.Transport.schedule(function(a){t.clap.start(a),t.clapVolume=t.getGain(1-e.velocity/128)},e.startTime);break;case 42:x.a.Transport.schedule(function(a){t.closedHat.start(a),t.closedHatVolume=t.getGain(1-e.velocity/128)},e.startTime);break;case 45:x.a.Transport.schedule(function(a){t.lowTom.start(a),t.lowTomVolume=t.getGain(1-e.velocity/128)},e.startTime);break;case 46:x.a.Transport.schedule(function(a){t.openHat.start(a),t.openHatVolume=t.getGain(1-e.velocity/128)},e.startTime);break;case 48:x.a.Transport.schedule(function(a){t.midTom.start(a),t.midTomVolume=t.getGain(1-e.velocity/128)},e.startTime);break;case 49:x.a.Transport.schedule(function(a){t.crash.start(a),t.crashVolume=t.getGain(1-e.velocity/128)},e.startTime);break;case 50:x.a.Transport.schedule(function(a){t.highTom.start(a),t.highTomVolume=t.getGain(1-e.velocity/128)},e.startTime);break;case 51:x.a.Transport.schedule(function(a){t.ride.start(a),t.rideVolume=t.getGain(1-e.velocity/128)},e.startTime)}}),this.melodySaveLoop=x.a.Transport.scheduleRepeat(function(e){t.melodySave?(t.playMelody(),t.melodySave=!1):t.notes=[]},"0"),x.a.Transport.start()}},{key:"playMelody",value:function(){var e=this;this.setState({melodyPresent:!0,status:"Looping Melody"}),x.a.Transport.stop(),x.a.Transport.clear(this.melodySaveLoop),this.melodyNotes=this.notes,this.melody=new x.a.Part(function(t,a){e.melodySynth.triggerAttackRelease(e.midiToFreq(a.pitch),a.duration,t),e.melodySynth.volume.value=a.gain},this.notes),this.melodySaveLoop=x.a.Transport.scheduleRepeat(function(t){e.melodySave?(e.melody.stop(),e.playMelody(),e.melodySave=!1):e.notes=[]},"0"),this.melody.start(0),x.a.Transport.start()}},{key:"midiToFreq",value:function(e){return 440*Math.pow(2,(e-69)/12)}},{key:"getGain",value:function(e){return 10*e*-1}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(R,{status:this.state.status,drumTemperature:this.state.drumTemperature,melodyTemperature:this.state.melodyTemperature,drums:this.state.drumsPresent,melody:this.state.melodyPresent,aiMelody:this.state.aiMelodyPresent,bassline:this.state.basslinePresent,ref:this.interfaceRef}))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(j,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[120,1,2]]]);
//# sourceMappingURL=main.5ba46275.chunk.js.map